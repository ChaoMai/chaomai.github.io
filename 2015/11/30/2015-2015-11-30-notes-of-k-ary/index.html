<!doctype html>




<html class="theme-next mist">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="reading,concurrency," />





  <link rel="alternate" href="/atom.xml" title="Building Things" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description" content="Brown在Toronto大学读PhD期间写过2篇关于k-ary的文章，他读PhD期间的导师是Ellen，而Ellen正是写了Non-blocking Binary Search Trees的那位。这篇文章里看到了好几个methods或者ideas是extended from Non-blocking Binary Search Trees。">
<meta property="og:type" content="article">
<meta property="og:title" content="Notes of Non-Blocking K-Ary Search Trees">
<meta property="og:url" content="http://chaomai.github.io/2015/11/30/2015-2015-11-30-notes-of-k-ary/index.html">
<meta property="og:site_name" content="Building Things">
<meta property="og:description" content="Brown在Toronto大学读PhD期间写过2篇关于k-ary的文章，他读PhD期间的导师是Ellen，而Ellen正是写了Non-blocking Binary Search Trees的那位。这篇文章里看到了好几个methods或者ideas是extended from Non-blocking Binary Search Trees。">
<meta property="og:image" content="http://7vilyb.com1.z0.glb.clouddn.com/k-ary_dummy.png">
<meta property="og:image" content="http://7vilyb.com1.z0.glb.clouddn.com/k-ary_states.png">
<meta property="og:image" content="http://7vilyb.com1.z0.glb.clouddn.com/k-ary_deletion.png">
<meta property="og:updated_time" content="2015-11-30T08:33:19.523Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Notes of Non-Blocking K-Ary Search Trees">
<meta name="twitter:description" content="Brown在Toronto大学读PhD期间写过2篇关于k-ary的文章，他读PhD期间的导师是Ellen，而Ellen正是写了Non-blocking Binary Search Trees的那位。这篇文章里看到了好几个methods或者ideas是extended from Non-blocking Binary Search Trees。">
<meta name="twitter:image" content="http://7vilyb.com1.z0.glb.clouddn.com/k-ary_dummy.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"right","display":"post"},
    fancybox: true,
    motion: false,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>

  <title> Notes of Non-Blocking K-Ary Search Trees | Building Things </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  








  
  
    
  

  <div class="container one-collumn sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Building Things</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Just want to know how it works!</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            Tags
          </a>
        </li>
      

      


      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Notes of Non-Blocking K-Ary Search Trees
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-11-30T15:09:25+08:00" content="2015-11-30">
              2015-11-30
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/programming/" itemprop="url" rel="index">
                    <span itemprop="name">programming</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/programming/data-structures/" itemprop="url" rel="index">
                    <span itemprop="name">data structures</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/11/30/2015-2015-11-30-notes-of-k-ary/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/11/30/2015-2015-11-30-notes-of-k-ary/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="About-k-ary-Search-Trees"><a href="#About-k-ary-Search-Trees" class="headerlink" title="About k-ary Search Trees"></a>About k-ary Search Trees</h1><ul>
<li>No duplicate key</li>
<li>Leaf-oriented k-ST</li>
<li>Each leaf has zero children and at most k - 1 keys</li>
<li>Each internal node has exactly k children and k − 1 keys (in increasing order)</li>
</ul>
<p>Non-blocking k-ary Search Trees需要平衡，tree的深度和每个internal node进行search和update时的work总量。</p>
<p>大的k–&gt;减少tree的depth，但是增加了每个internal node进行search和update时的work总量。</p>
<p>k = 4的时候，在高contention和低contention的情况下，性能都是最好的。<br>高contention时，较少的小k减少了update时影响到的key的数目，增加了并行度；低contention时，较少的depth加快了search，加快了update。</p>
<h1 id="From-BST-to-k-ary-Search-Trees"><a href="#From-BST-to-k-ary-Search-Trees" class="headerlink" title="From BST to k-ary Search Trees"></a>From BST to k-ary Search Trees</h1><ul>
<li>Insert: the BST’s insertion -&gt; sprouting insertion</li>
<li>Delete: the  BST’s deletion -&gt; pruning deletion</li>
<li>Coordination: extended from BST</li>
</ul>
<h1 id="Data-Structure"><a href="#Data-Structure" class="headerlink" title="Data Structure"></a>Data Structure</h1><h2 id="Nodes"><a href="#Nodes" class="headerlink" title="Nodes"></a>Nodes</h2><p>Each <strong>leaf</strong> has zero children and <strong>at most</strong> k − 1 keys (zero keys is permitted). Each <strong>internal node</strong> has exactly k children and k − 1 keys. Inside each node, keys are maintained in <strong>increasing order</strong>.</p>
<h2 id="Dummy-Nodes"><a href="#Dummy-Nodes" class="headerlink" title="Dummy Nodes"></a>Dummy Nodes</h2><p>Dummy nodes are used in BST to avoid special cases when there is no parent or grandparent to flag and mark. The following pruning deletion operation will meet similar problem. When perform pruning deletion, the leaf may <em>won’t have a parent or grandparent</em>. To avoid dealing with that, <strong>dummy nodes</strong> and <strong>empty leaves</strong> used again when initializing the tree.</p>
<p><img src="http://7vilyb.com1.z0.glb.clouddn.com/k-ary_dummy.png" alt=""></p>
<ul>
<li>Dummy nodes: each have k − 1 keys valued $\infty$.</li>
<li>Empty leaves: 2k - 1 empty keys in total.</li>
</ul>
<h1 id="Sequential-Operations"><a href="#Sequential-Operations" class="headerlink" title="Sequential Operations"></a>Sequential Operations</h1><h2 id="Insertion"><a href="#Insertion" class="headerlink" title="Insertion"></a>Insertion</h2><p>Search for the key first.</p>
<h3 id="Sprouting-Insertion"><a href="#Sprouting-Insertion" class="headerlink" title="Sprouting Insertion"></a>Sprouting Insertion</h3><p>If the leaf is full, replaces the leaf by a <em>newly created</em> subtree.</p>
<p>The newly created subtree:</p>
<ul>
<li>The k - 1 greatest keys among the original k - 1 keys and the new key.</li>
<li>The children are k (the original k - 1 keys and the new key) <em>new</em> nodes.</li>
</ul>
<h3 id="Simple-Insertion"><a href="#Simple-Insertion" class="headerlink" title="Simple Insertion"></a>Simple Insertion</h3><p>If the leaf is full, replaces the leaf by a <em>newly</em> leaf with k keys (the original k - 1 keys and the new key).</p>
<h2 id="Deletion"><a href="#Deletion" class="headerlink" title="Deletion"></a>Deletion</h2><p>First search for the key.</p>
<h3 id="Pruning-Deletion"><a href="#Pruning-Deletion" class="headerlink" title="Pruning Deletion"></a>Pruning Deletion</h3><p>If the leaf has one key <strong>and</strong> the parent of leaf has <em>exactly two non-empty children</em>, replace the parent with the sibling of leaf.</p>
<h3 id="Simple-Deletion"><a href="#Simple-Deletion" class="headerlink" title="Simple Deletion"></a>Simple Deletion</h3><p>If the leaf has more than one key <strong>or</strong> the parent of leaf has more than two non-empty children, replace the leaf by a <em>new</em> leaf with key removed.</p>
<h1 id="Coordination"><a href="#Coordination" class="headerlink" title="Coordination"></a>Coordination</h1><p>Interleaved execution between concurrent updates in some particular order may cause problems (of cause).</p>
<p>The Coordination is similar to BST, but here the scheme is extended.</p>
<p>The following <code>UpdateStep</code> (<code>ReplaceFlag</code>, <code>PruneFlag</code> and <code>Mark</code>) objects is just like lock.</p>
<h2 id="ReplaceFlag"><a href="#ReplaceFlag" class="headerlink" title="ReplaceFlag"></a>ReplaceFlag</h2><p>For both types of insertion and simple deletion.</p>
<h2 id="PruneFlag"><a href="#PruneFlag" class="headerlink" title="PruneFlag"></a>PruneFlag</h2><p>For pruning deletion.</p>
<h2 id="Mark"><a href="#Mark" class="headerlink" title="Mark"></a>Mark</h2><p>Before an internal node is to disappear from the tree, it must ﬁrst be marked. Once a internal node is marked, its child pointer will never be changed.</p>
<h2 id="Clean"><a href="#Clean" class="headerlink" title="Clean"></a>Clean</h2><p>Initial stat of the <code>pending</code> filed in internal node.</p>
<h1 id="Help-Mechanism"><a href="#Help-Mechanism" class="headerlink" title="Help Mechanism"></a>Help Mechanism</h1><p>If an operation is unexpectedly delayed while holding access to a ﬂagged or marked node, the progress cannot be guaranteed. So helping mechanism is necessary. The method taken here is similar to the one in BST.</p>
<p>But the helping <strong>should not be abused</strong>. To avoid many <em>duplicate operation</em>, the helping is used in limited cases.</p>
<h1 id="On-The-Whole"><a href="#On-The-Whole" class="headerlink" title="On The Whole"></a>On The Whole</h1><p>Just for clear the thought.</p>
<p>The following picture isn’t presented in the paper. Because the idea in the paper is similar to BST. So it easy to imitate the original one in BST.</p>
<p><img src="http://7vilyb.com1.z0.glb.clouddn.com/k-ary_states.png" alt=""></p>
<p><code>ReplaceFlag</code> is used in simple insertion, sprouting insertion and simple deletion. So the original notations, <code>ichild ...</code>, <code>dchild ...</code>, etc won’t apply.</p>
<h1 id="Differences-between-BST-and-k-ary-Search-Trees"><a href="#Differences-between-BST-and-k-ary-Search-Trees" class="headerlink" title="Differences between BST and k-ary Search Trees"></a>Differences between BST and k-ary Search Trees</h1><h2 id="Deletion-1"><a href="#Deletion-1" class="headerlink" title="Deletion"></a>Deletion</h2><p>There two types of deletion in k-ary Search Trees. And a particular interleave of insertion and deletion would result in key lost.</p>
<p><img src="http://7vilyb.com1.z0.glb.clouddn.com/k-ary_deletion.png" alt=""></p>
<p>Suppose there are some nodes in k-ary search tree (see above figure) and two threads concurrently perform update.</p>
<ul>
<li>Thread ti: insert d at b (the order doesn’t mater)</li>
<li>Thread td: delete b</li>
</ul>
<p>The following operation sequence is executed (direction of child isn’t mentioned, but it should be fairly easy to see),</p>
<ol>
<li>td: <code>PruneFlag</code> gp</li>
<li>ti: <code>ReplaceFlag</code> p<br>from now on, the p won’t be marked by td until ti finished.</li>
<li>ti: Finish insertion and <code>Clean</code> p</li>
<li>td: Mark p</li>
<li>td: Change the pointer in gp to s</li>
</ol>
<p><strong>Consequence:</strong> Insertion of key, d is lost. :(</p>
<p>The problem is that pruning deletion changes the child of gp to the child of p without knowing the modification in the another child of p.</p>
<p>Above problem won’t happen in BST’s deletion, <em>since the new node (internal node or leaf) is always built from scratch.</em></p>
<p>So the <code>pending</code> of p must be read before <code>PruneFlag</code> set at gp and checked when performing mark cas. If any insertion occurred, the <code>pending</code> of p will be bound to changed and deletion will perform backtracking cas and restart.</p>
<p>BTY: In BST and k-ary search tree, the <code>pending</code> of p is already  read by the end of search and the above prerequisites in implementation is <strong>already done</strong>. <em>But it has special purpose and meaning here.</em></p>
<h1 id="Some-Doubts"><a href="#Some-Doubts" class="headerlink" title="Some Doubts"></a>Some Doubts</h1><h2 id="CAS-and-CASet"><a href="#CAS-and-CASet" class="headerlink" title="CAS and CASet"></a>CAS and CASet</h2><p>In k-ary search trees, CASet (compare-and-set) is used to implement CAS.But the prerequisites is the algorithm doesn’t suffer from the ABA problem.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x.CAS(expect, value)</span><br><span class="line">  result = read(x)</span><br><span class="line">  if (result != expect) return result</span><br><span class="line">  if (x.CASet(expect, value)) return expect</span><br><span class="line">  return read(x)</span><br></pre></td></tr></table></figure>
<p>The reason why these algorithms doesn’t suffer from ABA problem is quite clear for me. But what does the prerequisites (doesn’t suffer from the ABA) for?</p>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ol>
<li>Non-blocking k-ary Search Trees, Trevor Brown, Joanna Helga</li>
<li>Non-blocking Binary Search Trees, Faith Ellen, Panagiota Fatourou, Eric Ruppert, Franck van Breugel</li>
</ol>

      
    </div>

    <div>
      
        
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/reading/" rel="tag">#reading</a>
          
            <a href="/tags/concurrency/" rel="tag">#concurrency</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/11/24/2015-2015-11-24-ckd-2/" rel="next" title="CKDTree (2)">
                <i class="fa fa-chevron-left"></i> CKDTree (2)
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/12/12/2015-2015-12-12-notes-of-k-ary-range-query/" rel="prev" title="Notes of Range Queries in Non-Blocking K-Ary Search Trees">
                Notes of Range Queries in Non-Blocking K-Ary Search Trees <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/default_avatar.jpg"
               alt="Chao Mai" />
          <p class="site-author-name" itemprop="name">Chao Mai</p>
          <p class="site-description motion-element" itemprop="description">Chao Mai's Blog</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">46</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>
          
          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">categories</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">26</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ChaoMai" target="_blank">
                  
                    <i class="fa fa-globe"></i> github
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/1898970107" target="_blank">
                  
                    <i class="fa fa-globe"></i> weibo
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.douban.com/people/chaomai" target="_blank">
                  
                    <i class="fa fa-globe"></i> douban
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/chao__mai" target="_blank">
                  
                    <i class="fa fa-globe"></i> twitter
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/chaomai" target="_blank">
                  
                    <i class="fa fa-globe"></i> zhihu
                  
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator">
            <i class="fa fa-angle-double-up"></i>
          </div>
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#About-k-ary-Search-Trees"><span class="nav-number">1.</span> <span class="nav-text">About k-ary Search Trees</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#From-BST-to-k-ary-Search-Trees"><span class="nav-number">2.</span> <span class="nav-text">From BST to k-ary Search Trees</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Data-Structure"><span class="nav-number">3.</span> <span class="nav-text">Data Structure</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Nodes"><span class="nav-number">3.1.</span> <span class="nav-text">Nodes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dummy-Nodes"><span class="nav-number">3.2.</span> <span class="nav-text">Dummy Nodes</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Sequential-Operations"><span class="nav-number">4.</span> <span class="nav-text">Sequential Operations</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Insertion"><span class="nav-number">4.1.</span> <span class="nav-text">Insertion</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sprouting-Insertion"><span class="nav-number">4.1.1.</span> <span class="nav-text">Sprouting Insertion</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Simple-Insertion"><span class="nav-number">4.1.2.</span> <span class="nav-text">Simple Insertion</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Deletion"><span class="nav-number">4.2.</span> <span class="nav-text">Deletion</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Pruning-Deletion"><span class="nav-number">4.2.1.</span> <span class="nav-text">Pruning Deletion</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Simple-Deletion"><span class="nav-number">4.2.2.</span> <span class="nav-text">Simple Deletion</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Coordination"><span class="nav-number">5.</span> <span class="nav-text">Coordination</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ReplaceFlag"><span class="nav-number">5.1.</span> <span class="nav-text">ReplaceFlag</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PruneFlag"><span class="nav-number">5.2.</span> <span class="nav-text">PruneFlag</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mark"><span class="nav-number">5.3.</span> <span class="nav-text">Mark</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Clean"><span class="nav-number">5.4.</span> <span class="nav-text">Clean</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Help-Mechanism"><span class="nav-number">6.</span> <span class="nav-text">Help Mechanism</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#On-The-Whole"><span class="nav-number">7.</span> <span class="nav-text">On The Whole</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Differences-between-BST-and-k-ary-Search-Trees"><span class="nav-number">8.</span> <span class="nav-text">Differences between BST and k-ary Search Trees</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Deletion-1"><span class="nav-number">8.1.</span> <span class="nav-text">Deletion</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Some-Doubts"><span class="nav-number">9.</span> <span class="nav-text">Some Doubts</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#CAS-and-CASet"><span class="nav-number">9.1.</span> <span class="nav-text">CAS and CASet</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#References"><span class="nav-number">10.</span> <span class="nav-text">References</span></a></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator">
            <i class="fa fa-angle-double-down"></i>
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2014 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chao Mai</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  


  




<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  
  
<script type="text/javascript" src="/js/src/scrollspy.js?v=0.5.0"></script>

<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 1 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = NexT.utils.escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    NexT.motion.middleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');

      if (CONFIG.scheme !== 'Pisces' && (CONFIG.sidebar.display === 'post' || CONFIG.sidebar.display === 'always')) {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          NexT.utils.displaySidebar();
        }
      }
    };
  });
</script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'chaomaisblog';
      var disqus_identifier = '2015/11/30/2015-2015-11-30-notes-of-k-ary/';
      var disqus_title = 'Notes of Non-Blocking K-Ary Search Trees';
      var disqus_url = 'http://chaomai.github.io/2015/11/30/2015-2015-11-30-notes-of-k-ary/';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
        run_disqus_script('embed.js');
      
    </script>
  



  
  
  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>

  
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  
  


</body>
</html>
